<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X For You Timeline Cleaner</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #1DA1F2; }
        ul { list-style-type: none; }
        li { margin-bottom: 10px; }
        .step { border-bottom: 1px solid #ccc; padding-bottom: 10px; }
        input[type="text"] { margin-right: 10px; }
        button { background-color: #1DA1F2; color: white; border: none; padding: 5px 10px; cursor: pointer; }
        button:hover { background-color: #0c85d0; }
        #auth-section { margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; }
        #status { color: red; }
    </style>
</head>
<body>
    <h1>X For You Timeline Cleaner</h1>
    <p>This tool helps you clean up your For You timeline using the X API where possible. First, authenticate with your X account.</p>
    
    <div id="auth-section">
        <h2>Authentication</h2>
        <p>To use API features, you need to create an app on <a href="https://developer.x.com/">developer.x.com</a> and get a Client ID. Set the redirect URI to your page URL (e.g., http://localhost:8000/cleaner.html). Use OAuth 2.0 with PKCE.</p>
        <label for="client-id">Client ID:</label>
        <input type="text" id="client-id" placeholder="Your Client ID">
        <label for="redirect-uri">Redirect URI:</label>
        <input type="text" id="redirect-uri" placeholder="e.g., http://localhost:8000/cleaner.html" value="http://localhost:8000/cleaner.html">
        <button id="auth-button">Authorize with X</button>
        <p id="auth-status"></p>
    </div>
    
    <h2>Understanding the For You Timeline on X</h2>
    <p><!-- Paste the understanding text here --></p>
    The "For You" timeline on X (formerly Twitter) is an algorithmic feed that shows a mix of posts from accounts you follow (about 50%) and recommended content from accounts you don't (the other 50%). It's designed to surface engaging or relevant posts based on your interactions, like likes, retweets, searches, and topics X infers from your activity. However, this can lead to clutter from ads, unwanted topics, or repetitive content. Cleaning it up involves training the algorithm, curating your follows, and using built-in tools to filter or reset recommendations. Changes may take a few days to fully take effect as the algorithm adjusts.

    <h2>Steps to Clean Up Your For You Timeline</h2>
    <ul>
        <li class="step">
            <input type="checkbox" id="step1">
            <label for="step1">1. Switch to the Following Timeline for a Chronological View</label>
            <p>The easiest quick fix is to avoid the algorithm altogether. At the top of your home screen, tap the tabs to switch from "For You" to "Following." This shows only posts from accounts you follow, in reverse chronological order—no recommendations or ads mixed in. You can toggle back anytime. To make "Following" your default: On mobile: Long-press the home icon in the bottom navigation and select "Following." On desktop: Click the sparkle icon (top right) to switch and pin it. This won't "clean" For You but gives you control over what you see immediately.</p>
        </li>
        <li class="step">
            <input type="checkbox" id="step2">
            <label for="step2">2. Mark Unwanted Posts as "Not Interested"</label>
            <p>When you see irrelevant recommendations in For You: Tap the three-dot menu (⋯) on the post. Select "Not interested in this post" or "Show fewer posts from [account]." Do this for 10–20 similar posts, and X will reduce that type of content over time. It's like negative feedback to refine the algorithm. For example, if politics or specific trends dominate, mark them repeatedly.</p>
            <p><em>No direct API for this; perform manually in the X app.</em></p>
        </li>
        <li class="step">
            <input type="checkbox" id="step3">
            <label for="step3">3. Unfollow or Mute Accounts You No Longer Want</label>
            <p>Review who you follow to eliminate sources of unwanted noise: Go to your profile > "Following" (shows a list of accounts). Click an account > three-dot menu > "Unfollow." Prioritize inactive accounts (no posts in months), bots, or those posting off-topic content. Aim to unfollow 50–100 if your list is bloated (X limits mass unfollows to avoid spam flags).</p>
            <label for="unfollow-username">Username to Unfollow:</label>
            <input type="text" id="unfollow-username" placeholder="@username">
            <button onclick="unfollowUser()">Unfollow</button>
            <p id="unfollow-status"></p>
            <p>Alternatively, mute without unfollowing: From their profile: Three-dot menu > "Mute @username." This hides their posts from your timeline and notifications without them knowing. Great for family or colleagues you don't want to unfollow outright.</p>
            <label for="mute-username">Username to Mute:</label>
            <input type="text" id="mute-username" placeholder="@username">
            <button onclick="muteUser()">Mute</button>
            <p id="mute-status"></p>
            <p>Pro tip: Use X Lists (see below) to organize follows without cluttering your main timeline.</p>
        </li>
        <li class="step">
            <input type="checkbox" id="step4">
            <label for="step4">4. Mute Words, Phrases, and Topics</label>
            <p>Filter out specific keywords or themes: Go to Settings and privacy > Privacy and safety > Mute and block > Muted words. Add terms like "politics," "crypto," or "#ad" (include variations, e.g., "election" OR "vote"). Toggle on "Home timeline" and set duration (e.g., forever or 7 days). You can also limit to non-followed accounts.</p>
            <p>For broader topics: Settings and privacy > Privacy and safety > Content you see > Interests (or Topics). Review suggested topics and tap the "X" next to ones you don't want (e.g., sports, news categories). This adds them to a "Not interested" list, reducing related recommendations. You can only dismiss ~50 at a time due to rate limits, but repeat as needed. Muting applies to For You and protects your mentions too.</p>
            <p><em>No API for muting words or topics; perform manually.</em></p>
        </li>
        <li class="step">
            <input type="checkbox" id="step5">
            <label for="step5">5. Clear Your Search and Interaction History to Reset the Algorithm</label>
            <p>The algorithm learns from your searches, likes, and views, so wiping this gives it a "fresh start": For search history: Go to the search bar > Recent searches > Clear all. Unlike old posts: Go to Likes tab on your profile > three-dot menu on a like > Unlike. Bulk-unlike via desktop or third-party tools (see below). Clear other history: Settings and privacy > Your account > Download an archive of your data (to back up first), then delete old likes, retweets, and replies manually. Avoid liking or engaging with unwanted content going forward. Users report it takes 1–2 weeks for noticeable improvements, but this effectively resets recommendations.</p>
            <p><em>API for unliking:</em></p>
            <button onclick="bulkUnlikeLikes()">Bulk Unlike All Likes (Caution: Irreversible, Rate Limited)</button>
            <p id="unlike-status"></p>
        </li>
        <li class="step">
            <input type="checkbox" id="step6">
            <label for="step6">6. Use X Lists for a Curated Feed</label>
            <p>Create custom timelines without altering your main follows: Go to Lists (in the side menu) > Create new list. Add accounts you want to see together (e.g., "News Only" or "Friends"). Pin the list to your home screen for quick access. Lists show chronological posts from those accounts only, bypassing For You clutter. It's a free, built-in way to organize and "clean" what you see.</p>
            <label for="list-name">List Name:</label>
            <input type="text" id="list-name" placeholder="My List">
            <button onclick="createList()">Create List</button>
            <p id="list-status"></p>
            <label for="add-to-list">List ID:</label>
            <input type="text" id="list-id" placeholder="List ID from above">
            <label for="add-username">Username to Add:</label>
            <input type="text" id="add-username" placeholder="@username">
            <button onclick="addToList()">Add to List</button>
            <p id="add-list-status"></p>
        </li>
        <li class="step">
            <input type="checkbox" id="step7">
            <label for="step7">7. Block Spam Accounts and Report Issues</label>
            <p>For bots or harassers polluting recommendations: On their post/profile: Three-dot menu > Block @username. Or Report > "It's spam" or "Irrelevant." Blocking removes them from suggestions. Also, in Settings > Notifications > Filters, enable "Quality filter" and "Muted notifications" to hide low-quality content.</p>
            <label for="block-username">Username to Block:</label>
            <input type="text" id="block-username" placeholder="@username">
            <button onclick="blockUser()">Block</button>
            <p id="block-status"></p>
        </li>
        <li class="step">
            <input type="checkbox" id="step8">
            <label for="step8">8. Advanced: Bulk Delete Old Tweets, Likes, and Followers (Optional Deep Clean)</label>
            <p>If your past activity is training bad recommendations: Download your X archive (Settings > Your account > Download an archive). Use official partners like TweetDelete or TweetEraser (free tiers available) to bulk-delete old tweets, likes, or retweets by date/keyword. This clears your profile and can indirectly improve For You by removing outdated signals. Note: X API limits deletions, so it may take time.</p>
            <p>For followers: Manually remove fakes via your Followers list > three-dot menu > Remove this follower. Tools like Circleboom can help identify and mass-remove inactive ones.</p>
            <p><em>API for bulk delete tweets:</em></p>
            <button onclick="bulkDeleteTweets()">Bulk Delete All Tweets (Caution: Irreversible, Rate Limited)</button>
            <p id="delete-tweets-status"></p>
            <p><em>Remove Follower:</em></p>
            <label for="remove-follower">Follower Username to Remove:</label>
            <input type="text" id="remove-follower" placeholder="@username">
            <button onclick="removeFollower()">Remove Follower</button>
            <p id="remove-follower-status"></p>
        </li>
    </ul>
    
    <h2>Additional Tips</h2>
    <p><!-- Paste additional tips here --></p>
    - Be Patient and Consistent: Engage only with content you want more of (likes, replies). Avoid clicking on unwanted posts, as it signals interest.<br>
    - No Official Reset Button: X doesn't have a one-click algorithm reset, but the above mimics it. Some users suggest deactivating/reactivating your account briefly, but this risks losing data—avoid unless necessary.<br>
    - Privacy Boost: In Settings > Privacy and safety > Discoverability, turn off "Suggest your account" and location sharing to reduce irrelevant suggestions.<br>
    - If It's Ads: For You prioritizes promoted content; mute keywords like "sponsored" or upgrade to X Premium for fewer ads (details at https://help.x.com/en/using-x/x-premium).<br>
    - Limitations: Changes aren't instant, and X's algorithm is proprietary—open-sourcing parts hasn't fully demystified it. If issues persist, check X's help center or contact support.<br>
    Following these steps should make your For You timeline more relevant and less overwhelming. Start with switching to Following and marking not interested for quick wins!

    <script>
        // PKCE helpers
        function base64UrlEncode(str) {
            return btoa(str).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
        }

        async function sha256(plain) {
            const encoder = new TextEncoder();
            const data = encoder.encode(plain);
            return window.crypto.subtle.digest('SHA-256', data);
        }

        async function generateCodeChallenge(verifier) {
            const hashed = await sha256(verifier);
            return base64UrlEncode(String.fromCharCode.apply(null, new Uint8Array(hashed)));
        }

        // Auth
        const authButton = document.getElementById('auth-button');
        const clientIdInput = document.getElementById('client-id');
        const redirectUriInput = document.getElementById('redirect-uri');
        const authStatus = document.getElementById('auth-status');

        authButton.onclick = async () => {
            const clientId = clientIdInput.value;
            const redirectUri = redirectUriInput.value;
            if (!clientId || !redirectUri) {
                authStatus.textContent = 'Please enter Client ID and Redirect URI.';
                return;
            }

            const verifier = base64UrlEncode(crypto.getRandomValues(new Uint8Array(32)));
            const challenge = await generateCodeChallenge(verifier);
            localStorage.setItem('code_verifier', verifier);
            localStorage.setItem('client_id', clientId);
            localStorage.setItem('redirect_uri', redirectUri);

            const scopes = 'users.read tweet.read mute.write block.write like.write follow.write list.write tweet.write offline.access';
            const authUrl = `https://twitter.com/i/oauth2/authorize?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}&state=state&code_challenge=${challenge}&code_challenge_method=S256`;
            window.location.href = authUrl;
        };

        // On load, check for code
        window.onload = async () => {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');
            if (code) {
                const verifier = localStorage.getItem('code_verifier');
                const clientId = localStorage.getItem('client_id');
                const redirectUri = localStorage.getItem('redirect_uri');
                if (!verifier || !clientId || !redirectUri) {
                    authStatus.textContent = 'Missing auth data.';
                    return;
                }

                const tokenUrl = 'https://api.twitter.com/2/oauth2/token';
                const body = `code=${code}&grant_type=authorization_code&client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&code_verifier=${verifier}`;

                try {
                    const response = await fetch(tokenUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: body
                    });
                    const data = await response.json();
                    if (data.access_token) {
                        localStorage.setItem('access_token', data.access_token);
                        localStorage.setItem('refresh_token', data.refresh_token);
                        authStatus.textContent = 'Authenticated successfully!';
                    } else {
                        authStatus.textContent = 'Auth failed: ' + JSON.stringify(data);
                    }
                } catch (error) {
                    authStatus.textContent = 'Error: ' + error.message;
                }
            }
        };

        // Helper to get access token
        async function getAccessToken() {
            let token = localStorage.getItem('access_token');
            // TODO: Check expiration and refresh if needed
            return token;
        }

        // Helper to get user ID by username
        async function getUserId(username) {
            const token = await getAccessToken();
            if (!token) return null;
            const url = `https://api.twitter.com/2/users/by/username/${username.replace('@', '')}`;
            const response = await fetch(url, { headers: { Authorization: `Bearer ${token}` } });
            const data = await response.json();
            return data.data ? data.data.id : null;
        }

        // Helper to get my user ID
        async function getMyId() {
            const token = await getAccessToken();
            if (!token) return null;
            const url = 'https://api.twitter.com/2/users/me';
            const response = await fetch(url, { headers: { Authorization: `Bearer ${token}` } });
            const data = await response.json();
            return data.data ? data.data.id : null;
        }

        // Unfollow
        async function unfollowUser() {
            const username = document.getElementById('unfollow-username').value;
            const status = document.getElementById('unfollow-status');
            if (!username) {
                status.textContent = 'Enter username.';
                return;
            }
            const targetId = await getUserId(username);
            const myId = await getMyId();
            if (!targetId || !myId) {
                status.textContent = 'Failed to get IDs.';
                return;
            }
            const url = `https://api.twitter.com/2/users/${myId}/following/${targetId}`;
            const response = await fetch(url, {
                method: 'DELETE',
                headers: { Authorization: `Bearer ${await getAccessToken()}` }
            });
            if (response.ok) {
                status.textContent = 'Unfollowed successfully.';
            } else {
                status.textContent = 'Failed: ' + response.statusText;
            }
        }

        // Mute
        async function muteUser() {
            const username = document.getElementById('mute-username').value;
            const status = document.getElementById('mute-status');
            if (!username) {
                status.textContent = 'Enter username.';
                return;
            }
            const targetId = await getUserId(username);
            const myId = await getMyId();
            if (!targetId || !myId) {
                status.textContent = 'Failed to get IDs.';
                return;
            }
            const url = `https://api.twitter.com/2/users/${myId}/muting`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    Authorization: `Bearer ${await getAccessToken()}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ target_user_id: targetId })
            });
            const data = await response.json();
            if (data.data?.muted) {
                status.textContent = 'Muted successfully.';
            } else {
                status.textContent = 'Failed: ' + JSON.stringify(data);
            }
        }

        // Block
        async function blockUser() {
            const username = document.getElementById('block-username').value;
            const status = document.getElementById('block-status');
            if (!username) {
                status.textContent = 'Enter username.';
                return;
            }
            const targetId = await getUserId(username);
            const myId = await getMyId();
            if (!targetId || !myId) {
                status.textContent = 'Failed to get IDs.';
                return;
            }
            const url = `https://api.twitter.com/2/users/${myId}/blocking`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    Authorization: `Bearer ${await getAccessToken()}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ target_user_id: targetId })
            });
            const data = await response.json();
            if (data.data?.blocking) {
                status.textContent = 'Blocked successfully.';
            } else {
                status.textContent = 'Failed: ' + JSON.stringify(data);
            }
        }

        // Remove Follower
        async function removeFollower() {
            const username = document.getElementById('remove-follower').value;
            const status = document.getElementById('remove-follower-status');
            if (!username) {
                status.textContent = 'Enter username.';
                return;
            }
            const targetId = await getUserId(username);
            const myId = await getMyId();
            if (!targetId || !myId) {
                status.textContent = 'Failed to get IDs.';
                return;
            }
            const url = `https://api.twitter.com/2/users/${myId}/followers/${targetId}`;
            const response = await fetch(url, {
                method: 'DELETE',
                headers: { Authorization: `Bearer ${await getAccessToken()}` }
            });
            if (response.ok) {
                status.textContent = 'Removed follower successfully.';
            } else {
                status.textContent = 'Failed: ' + response.statusText;
            }
        }

        // Create List
        async function createList() {
            const name = document.getElementById('list-name').value;
            const status = document.getElementById('list-status');
            if (!name) {
                status.textContent = 'Enter list name.';
                return;
            }
            const url = 'https://api.twitter.com/2/lists';
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    Authorization: `Bearer ${await getAccessToken()}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name, private: false }) // Change to true if private
            });
            const data = await response.json();
            if (data.data?.id) {
                status.textContent = `List created with ID: ${data.data.id}`;
            } else {
                status.textContent = 'Failed: ' + JSON.stringify(data);
            }
        }

        // Add to List
        async function addToList() {
            const listId = document.getElementById('list-id').value;
            const username = document.getElementById('add-username').value;
            const status = document.getElementById('add-list-status');
            if (!listId || !username) {
                status.textContent = 'Enter list ID and username.';
                return;
            }
            const userId = await getUserId(username);
            if (!userId) {
                status.textContent = 'Failed to get user ID.';
                return;
            }
            const url = `https://api.twitter.com/2/lists/${listId}/members`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    Authorization: `Bearer ${await getAccessToken()}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user_id: userId })
            });
            const data = await response.json();
            if (data.data?.is_member) {
                status.textContent = 'Added to list successfully.';
            } else {
                status.textContent = 'Failed: ' + JSON.stringify(data);
            }
        }

        // Bulk Unlike Likes
        async function bulkUnlikeLikes() {
            const status = document.getElementById('unlike-status');
            const myId = await getMyId();
            if (!myId) {
                status.textContent = 'Failed to get your ID.';
                return;
            }
            let nextToken = null;
            let count = 0;
            do {
                let url = `https://api.twitter.com/2/users/${myId}/liked_tweets?max_results=100`;
                if (nextToken) url += `&pagination_token=${nextToken}`;
                const response = await fetch(url, { headers: { Authorization: `Bearer ${await getAccessToken()}` } });
                const data = await response.json();
                if (!data.data) break;
                for (const tweet of data.data) {
                    const unlikeUrl = `https://api.twitter.com/2/users/${myId}/likes/${tweet.id}`;
                    await fetch(unlikeUrl, {
                        method: 'DELETE',
                        headers: { Authorization: `Bearer ${await getAccessToken()}` }
                    });
                    count++;
                }
                nextToken = data.meta.next_token;
                status.textContent = `Unliked ${count} likes so far...`;
            } while (nextToken);
            status.textContent = `Unliked ${count} likes completely.`;
        }

        // Bulk Delete Tweets
        async function bulkDeleteTweets() {
            const status = document.getElementById('delete-tweets-status');
            const myId = await getMyId();
            if (!myId) {
                status.textContent = 'Failed to get your ID.';
                return;
            }
            let nextToken = null;
            let count = 0;
            do {
                let url = `https://api.twitter.com/2/users/${myId}/tweets?max_results=100`;
                if (nextToken) url += `&pagination_token=${nextToken}`;
                const response = await fetch(url, { headers: { Authorization: `Bearer ${await getAccessToken()}` } });
                const data = await response.json();
                if (!data.data) break;
                for (const tweet of data.data) {
                    const deleteUrl = `https://api.twitter.com/2/tweets/${tweet.id}`;
                    await fetch(deleteUrl, {
                        method: 'DELETE',
                        headers: { Authorization: `Bearer ${await getAccessToken()}` }
                    });
                    count++;
                }
                nextToken = data.meta.next_token;
                status.textContent = `Deleted ${count} tweets so far...`;
            } while (nextToken);
            status.textContent = `Deleted ${count} tweets completely.`;
        }
    </script>
</body>
</html>
